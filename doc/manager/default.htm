<html>

<head>
<title>Archive Manager</title>
<link REL="STYLESHEET" HREF="../style.css" TYPE="text/css">
</head>

<body BACKGROUND="../blueback.jpg">

<blockquote>
  <h1>Archive Manager</h1>
  <p>
  <a href="#usage">Usage</a>
   - <a href="#Examples">Examples</a>
   - <a href="#Note">Creating new archives</a>
  <p>
  The ArchiveManager tool started as a test for the archive I/O library.
  It can be used for basic archive data file maintainance.
  It evolved into command-line monster, but archive repairs on GB
  files take time and this tool can run batch-driven over weekends.
  An alternate and soon to be preferred version is the python-based
  cardminer tool.
  <p>
  Before using the ArchiveManager, be sure to read and understand the
  information about the <a href="../binarchive/default.htm">binary
  archive format</a>.

  <h2><a name="usage">Usage</a></h2>
  The tool displays an option summary like this:
  <pre>USAGE:  ArchiveManager [Options] &lt;archive&gt;

Options:
        -info                          Show archive information
        -test                          Test archive for errors
        -channel &lt;channel&gt;             Specify channel name
        -match &lt;regular expression&gt;    List matching channels
        -Match &lt;regular expression&gt;    Dump values for matching channels
        -start &lt;time&gt;                  Start time as mm/dd/yyyy hh:mm:ss[.nano-secs]
        -end &lt;time&gt;                    End time (exclusive)
        -xport &lt;new archive&gt;           export data into new archive
        -repeat_limit &lt;seconds&gt;        remove 'repeat' entries beyond limit (export)
        -FileSize &lt;days&gt               Days per binary data file (export, binary file format detail)  
        -headers &lt;channel&gt;             show headers for channel
        -Output &lt;channel&gt;              output ASCII dump for channel
        -Input &lt;ascii file&gt;            read ASCII dump for channel into archive
        -Compare &lt;target archive&gt;      Compare with target archive
        -Seek                          Seek test (use with -start)
        -Copy &lt;new name&gt;               Copy channel name
        -DELETE &lt;channel&gt;              Delete channel from directory file
 </pre>

  <h2><a name="Examples">Examples</a>:</h2>
  Suppose &quot;ARCH&quot; is set to some valid archive:<em><br>
  ARCH=/home/fred/Epics/extensions/src/ChannelArchiver/Engine/Test/freq_directory</em>

  <h3>Show time range of archive</h3>
  <em>ArchiveManager $ARCH -i</em>

  <h3>Test archive</h3>
  <em>ArchiveManager $ARCH -T</em>
  <p>
  Tries to read all values for all channels, reporting errors while
  doing this. Since a broken archive might be broken in many
  unexpected ways, this test will always be uncomplete, but if the
  test succeeds, retrival tools should have no problem looking at the
  samples.

  <h3>Show time of first/last sample for specific channel</h3>
  <em>ArchiveManager $ARCH -c jane -i</em>

  <h3>List all channel names</h3>
  <em>ArchiveManager $ARCH</em>

  <h3>List all values for specific channel</h3>
  <em>ArchiveManager $ARCH -c janet</em>

  <h3>... between given times</h3>
  <em>ArchiveManager $ARCH -c is_hvps_actv -s &quot;02/10/2000 17:21:17&quot; -e
  &quot;02/10/2000 17:43:22&quot;</em>

  <h3>Copy, delete, rename entries</h3>
  <em>ArchiveManager $ARCH -DELETE fred</em><br>
  will delete the entry 'fred' from the directory file.
  Note that this does <u>not</u> remove any samples or compact
  the data files, you have to copy the data files
  to accomplish this. (see '-xport' option).
  And by the way <u>there is no way back, the channel is gone.</u>
  <p>
  <em>ArchiveManager $ARCH -channel fred -Copy egon</em><br>
  will create a copied name in the directory file.
  This does <u>not</u> copy any data: The new name is merely an
  alias for the original name.<br>
  This option becomes useful in connection with the delete, because
  copy and delete combine to a "rename" option:<br>
  <em>ArchiveManager $ARCH -channel old_name -Copy new_name</em><br>
  <em>ArchiveManager $ARCH -DELETE old_name</em><br>

  <h3>Dump channel in ASCII</h3>
  <em>ArchiveManager $ARCH -O is_hvps_actv &gt;is_hvps_actv.txt</em>

  <h3>Add values from ASCII dump (<a href="#Note">see note</a>)</h3>
  <em>ArchiveManager /tmp/new_dir -I is_hvps_actv.txt</em>

  <h3>Copy archive (<a href="#Note">see note</a>)</h3>
  <u><font color="#008000">This is the major repair facility for now (besides editing the
  ASCII dump):</font></u>
  <p>
  <em>ArchiveManager $ARCH -x /tmp/new_dir</em>
  <p>
  While copying the samples, bad CtrlInfo entries or samples that go
  &quot;back in time&quot; are skipped. With the &quot;-r&quot; option,
  outrageous repeat counts can be removed.
  <p>
  The newly generated archive is more tighly packed, consuming less
  disk space and allowing faster retrival.

  <h3>Create monthly extract, e.g. for CD-ROM
      (<a href="#Note">see note</a>)</h3>
  <em>ArchiveManager $ARCH -x /tmp/new_dir -s &quot;01/01/2000 00:00:00&quot; -e
  &quot;02/01/2000 00:00:00&quot;</em>

  <h3>Restore extract from CD-ROM to new archive
     (<a href="#Note">see note</a>)</h3>
  <em>ArchiveManager /mnt/cdrom/dir -x /tmp/new_dir -s &quot;01/01/2000 00:00:00&quot;</em>
  <p>
  (assuming that /mnt/cdrom/dir holds a &quot;January 2000&quot; extract)
  <hr>

  <h3><a name="Note">Note on creating new archives</a></h3>
  The ArchiveManager can create new archives by extracting samples
  from an existing archive or reading ASCII files. It can also add
  samples to an existing archive.
  <p>
  <font color="#FF0000">But:</font> It cannot remove entries from an archive.<br>
  It cannot add a sample stamped before the last sample for that
  channel.
  <p>
  <u>Example:</u><br>
  If channel X has samples up to &quot;02/01/2000 18:35:12&quot;,<br>
  you cannot add a sample stamped &quot;02/01/2000 18:00:00&quot;
  because that would go back in time.
  <p>
  Idea for maintaining the archive:
  <ul>
    <li>Create a monthly extract and put it on CD-ROM<br>
      - or weekly, bi-monthly, .. whatever has &quot;CD ROM size&quot;.
    <li>From that, you can then restore the archive by
    <ol>
      <li>copying the first CD over,
      <li>adding the samples from the next CD,
      <li>adding the third CD
      <li>...
    </ol>
  </ul>

  <hr>
  <a href="../default.htm">ChannelArchiver Manual</a>
</blockquote>
</body>
</html>
