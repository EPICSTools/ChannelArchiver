<!doctype HTML public "-//W3O//DTD W3 HTML 3.0//EN">

<html>

  <head>
    <title>Channel Archive Manager</title>
    <link REL="STYLESHEET" HREF="../style.css" TYPE="text/css">
  </head>

  <body background="../blueback.jpg">
      <h1>Channel Archive Manager</h1>
      <p>
	This is a simple frontend to the ChannelArchiver.
      </p>
      <p>
	It manages and observes <em>ArchiveEngine</em> processes and their
	appropriate directories.
      </p>
      <p>
	The Channel Archive Manager (<em>CAManager</em>) consists of two
	programs:
      </p>

      <ul>
	<li><a href="#CAManager">CAManager</a> - The <em>CAManager</em> frontend
	<li><a href="#CAbgManager">CAbgManager</a> - The backend that starts/restarts archivers
      </ul>

      <hr noshade size=1>
      <img align=right src="main.jpg" width=375 height=125 hspace=8 vspace=8>
      <a name="CAManager"><h1>CAManager</h1></a>
      <p>
	The main frontend.
      </p>
      <p>
	<em>CAManager</em> is a GUI Application, that enables you to
	configure and start/stop <em>ArchiveEngine</em> processes. You can
	also configure the properties of the
	ArchiveEngine. <em>CAManager</em> also provides simple interfaces
	to the applications <em>ArchiveManager</em> and
	<em>ArchiveExport</em>, so you have access to the following
	functions/tools.
      </p>
      <ul>
	<li><a href="#creat">Creating/Configuring an Archiver</a>
	<li><a href="#block">Blocking an Archiver</a>
	<li><a href="#test">Test</a>
	<li><a href="#info">Info</a>
	<li><a href="#export">Export</a>
      </ul>
      <hr noshade size=1>
      <img src="prop.jpg" width=212 height=226 align=right hspace=8 vspace=8>
      <a name="creat"><h2>Creating/Configuring an Archiver</h2></a>
      <p>
	A double-click on an archiver (an entry of the table in the main
	screen) opens the configuration-dialog. If you create a new
	archiver, the configuration-dialog also opens automatically.
      </p>
      <p>
	If the archiver you are configuring is currently running, some of
	the configurable properties in the dialog are disabled.
      </p>
      <p>
	A button with three dots in it opens a file-selection dialog. Most
	other string entries have a list of suggestions and settings, that
	are in available in another configuration, attached to it.
      </p>
      <p>
	The space below the Run/Rerun configuration option changes it's
	contents according to the selected Run/Rerun scheme.
      </p>
      <p>
	You have to configure the following properties:
      </p>
      <hr noshade size=1>
      <dl>
	<dt><b>Host</b></dt>
	<dd>The host on which the ArchiveEngine should run.</dd>
	<hr noshade size=1>
	<dt><b>Port</b></dt>
	<dd>The portnumber for the ArchiveEngine web interface<br>
	  <b>You have to ensure, that there are no collisions with other
	    applications using the same port!</b></dd>
	<hr noshade size=1>
	<dt><b>Configuration-file</b></dt>
	<dd>The <em>main</em> configuration file containing
	  archiving-parameters and channel names as well as <tt>!group</tt>
	  statements to include other files.<br>
	  <b>This parameter has to be a full pathname (starting with a "<tt>/</tt>"
	    or e.g. "<tt>C:/</tt>" resp.)</b></dd>
	<hr noshade size=1>
	<dt><b>disable configuration changes ...</b></dt>
	<dd>check this flag if you want to disable the online configuration
	  interface of the <em>ArchiveEngine</em>. This is especially
	  useful to avoid conflicting changes, if you create your
	  configuration from a different source.</dd>
	<hr noshade size=1>
	<dt><b>Archive-file</b></dt>
	<dd>
	  <p>This is the name of the archive directory file - the central
	    register of what is archived in this archive. This parameter
	    shouldn't be an abslolute pathname but a filename relative to the
	    directory of the configuration file.
	  </p>
	  <p>
	    The filename may contain directory components as well, but
	    shouldn't start with a "<tt>/</tt>".
	  </p>
	  <p>
	    It may also contain special components (starting with a
	    "<tt>%</tt>") that are replaced by strings depending on the current time.
	  </p>
	  <p>These components are:</p>
	  <table>
	    <tr><th align=left valign=top>%Y</th><td>current year (e.g. 2001)</td></tr>
	    <tr><th align=left valign=top>%m</th><td>current month (e.g. 10)</td></tr>
	    <tr><th align=left valign=top>%B</th><td>abbreviated name of the current month (e.g. October)</td></tr>
	    <tr><th align=left valign=top>%b</th><td>abbreviated name of the current month (e.g. Oct)</td></tr>
	    <tr><th align=left valign=top>%V</th><td>current weeknumber (e.g. 41)</td></tr>
	    <tr><th align=left valign=top>%d</th><td>day of month (e.g. 09)</td></tr>
	    <tr><th align=left valign=top>%p</th><td>AM or PM</td></tr>
	    <tr><th align=left valign=top>%H</th><td>hour (24h format)</td></tr>
	    <tr><th align=left valign=top>%I</th><td>hour (12h format)</td></tr>
	    <tr><th align=left valign=top>%M</th><td>minute</td></tr>
	    <tr><th align=left valign=top>%S</th><td>second</td></tr>
	    <tr><th align=left valign=top>%%</th><td>a single percent sign</td></tr>
	    <tr><th align=left valign=top>...</th><td>(see <tt>man strftime</tt> for details)</td></tr>
	  </table>
	  <p>
	    If this parameter contains a directory-component that is
	    different from the current directory, the
	    <em>CAbgManager</em> will create the appropriate directories
	    before starting the archiver. All configuration files are
	    then copied into this new directory. As the archiver
	    terminates all configuration files are copied back into the
	    main configuration directory and (if a directory named
	    <tt>CVS</tt> is available) checked into <em>cvs</em>
	    automatically to make online configuration changes persistent.
	  </p></dd>
	<hr noshade size=1>
	<dt><b>Log-file</b></dt>
	<dd><p>The ArchiveEngine logs it's output to this file.</p>
	  <p>This should also be a filename relative to the directory of
	    the configuration file.</p>
	  <p>"<tt>%</tt>"-rules are applied like with the Archive-file option.</p></dd>
	<hr noshade size=1>
	<dt><b>Run/Rerun</b></dt>
	<dd><p>The <em>CAbgManager</em> is able to stop and restart archivers based on
	    a certain schedule.
	  </p><p>
	    This is especially useful, if you automatically want archives
	    to be switched e.g. every week. In this case, set the
	    Run/Rerun mode to <tt>weekly</tt>, select the appropriate
	    weekday and time, when archives should be switched and set
	    the Archive-file configuration option to e.g. "<tt>%Y/%V/directory</tt>".
	  </p><p>
	    In this case the archiver would create one archive per week
	    in a directory named
	    <tt>[year]/[weeknumber]/directory</tt>. This directory will
	    also be added to a <em>Multi-Archive</em> directory file in the
	    directory of the main configuration file which may then
	    e.g. look like this for an archiver rerun daily:</p>
	  <pre>
master_version=1
# added by CAbgManager @ Thu Oct 09 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/09/directory
# added by CAbgManager @ Thu Oct 08 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/08/directory
# added by CAbgManager @ Thu Oct 07 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/07/directory
# added by CAbgManager @ Thu Oct 06 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/06/directory
# added by CAbgManager @ Thu Oct 05 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/05/directory
# added by CAbgManager @ Thu Oct 04 06:00:02 MDT 2001
/cs/epics/extensions/src/ChannelArchiver/CAManager/sampleArchives/another example/2001/10/04/directory
...
	  </pre>
	  <p>
	    This <em>Multi-Archive</em> directory file can then be used
	    to access the whole archive at once.
	  </p></dd>
      </dl>
      <hr noshade size=1>
      <a name="block"><h2>Blocking an archiver</h2></a>
      <p>
	When an archiver that is supposed to run terminates (either
	intentionally or not)), the archiver is automatically restarted by
	the <a href="#CAbgManager">CAbgManager</a>.<br> In certain cases,
	you might want to prevent this archiver from being restarted
	(e.g. for reconfiguration, during a special shutdown...).
      </p><p>
	In this case you may <em>block</em> such an archive. Just check the
	checkbox for the appropriate archiver in the rightmost column of
	the main window.<br>See <a href="#blocked">CAbgManager / Blocked Archivers</a> for
	further details.
      </p>
      <hr noshade size=1>
      <a name="test"><h2>Test</h2></a>
      <p>
      A simple frontend to the command
      </p>
      <pre>
    ArchiveManager -test &lt;archive&gt;
      </pre>
      <p>
	The test-command test an archive for errors.
      </p>

      <hr noshade size=1>
      <a name="info"><h2>Info</h2></a>
      <p>
	A simple frontend to the command
      </p>
      <pre>
    ArchiveManager -info &lt;archive&gt;
      </pre>
      <p>
	The info-command counts the number of channels in the archive and prints
	the min and max timestamps in the archive.
      </p>

      <hr noshade size=1>
      <img src="export.jpg" align=right width=296 height=288 hspace=8 vspace=8>
      <a name="export"><h2>Export</h2></a>
      <p>
	A simple frontend to the commands
      </p>
      <pre>
    ArchiveManager -xport [new archive] ...
      </pre>
      <p>
	for exporting to another archive, or
      </p>
      <pre>
    ArchiveExport ...
      </pre>
      <p>
	for exporting to a spreadsheet/matlab/gnuplot-file.
      </p>
      <p>
	The first version <em>Exporting to another archive</em> can be used to 
      </p>
      <ul>
	<li>extract a certain slice from an archive (by channel or by time or both)</li>
	<li> merge an archive into another one</li>
      </ul>
      <p>
	The second version is mainly for further processing with e.g. Excel,
	Origin, Matlab...
      </p>

      <hr noshade size=1>
      <img src="bgmanager.jpg" width=317 height=307 align=right hspace=8 vspace=8>
      <a name="CAbgManager"><h1>CAbgManager</h1></a>
      <p>
	This process has no GUI and doesn't produce output.
      </p>
      <p>
	It reads the current configuration and starts/stops/restarts
	<em>ArchiveEngines</em> after preparing the appropriate directories.
      </p>
      <p>
	The actions of <em>CAbgManager</em> and the status of configured
	<em>ArchiveEngines</em> can be observed via a web-page
	(http://&lt;hostname&gt;:&lt;port&gt;/) where port defaults to
	4610. The port-setting can be configured in the <em>CAManager</em>
	Edit/Preferences dialog.
      </p>
      <p>
	Configuration is re-read as it changes and jobs are rescheduled to match
	the new configuration.
      </p>
      <p>
	The port-setting applies on restart of the <em>CAbgManager</em>.
      </p>
      <p>
	By default <em>CAManager</em> automatically checks for a running <em>CAbgManager</em> on
	startup.
      </p>

      <hr noshade size=1>
      <a name="blocked"><h2>Blocked Archivers</h2></a>
      <p>
	The <em>CAbgManager</em> starts every configured archiver, that is
	supposed to run as long as the archiver is not blocked. If it is
	blocked and hence the <em>CAbgManager</em> can't restart it. A
	corresponding message is appended to the action-log.
      </p>

      <hr noshade size=1>
      <a name="commands"><h2>Commands</h2></a>
      <p>
	The web-interface of <em>CAbgManager</em> can be used to start or
	stop archivers.<br>
	These start and stop actions automatically unblock (start) or block
	(stop) the automatic restart of an archiver.
      </p>
      <p>
	If you query the page "http://&lt;hostname&gt;:&lt;port&gt;/stop", the <em>CAbgManager</em> is
	stopped.
      </p>
      <hr>
      <div align=right>
	<i>
	  <!-- hhmts start -->
		  Latest modification: 09 Oct 01 14:11:43 Thomas Birke
		  <!-- hhmts end -->
	</i>
	<address>
	  <a href="mailto:birke@lanl.gov">birke@lanl.gov</a>
	</address>
      </div>
      <hr>
  </body>

</html>
