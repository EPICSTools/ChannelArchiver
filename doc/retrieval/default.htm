<html>

<head>
<title>Retrieval</title>
<link REL="STYLESHEET" HREF="../style.css" TYPE="text/css">
</head>

<body background="../blueback.jpg">

<blockquote>
  <h1>Retrieval</h1>
  The ArchiveEngine stores the data in a collection of disk files.
  To look at the data, you should not open these files yourself but
  use one of the
  <A HREF="../overview/default.htm#retrieval">
  retieval tools mentioned in the overview.</A>.
  <br>
  These are some common issues that pertain to all retrieval tools.

  <h2>Directory File</h2>
  All retrieval tools have to know where the archive data is that
  they are supposed to look at.
  Therefore you provide the name of the "directory file"
  that the ArchiveEngine created. Note that this is a file name, not a
  directory name. The file itself is called a directory file.
  By default, the ArchiveEngine will create a direcory file called
  <code>freq_directory</code>, but this is configurable (I personally
  prefer to run the ArchiveEngine such that the directory file ends up being
  called <code>dir</code>).
  If you are not in the directory which contains the directory file,
  you have to provide the full path name, e.g.<br>
  <code>/cs/archives/linac/vaccum/2001_05/dir</code><br>
  In some cases you might not actually know which directory file
  you are using because somebody else prepared e.g. a script for you,
  a script that launches some retrieval tool and provides the
  correct directory file to the tool. Another common example:
  You are going through a  web page that uses the CGIExport tool.
  If you are interested in getting at the same data with other tools,
  you have to ask that helpful person for the full path to the
  directory file.
  <br>
  <A HREF="../binarchive/default.htm">Details on the directory file,
  the data files, the "Multi Archive", ...</a>
  
  <h2>Non-Values</h2>
  The ChannelArchiver does not only store the raw values
  but also status information. When the comminucation with
  the ChannelAccess server goes down (Example: IOC rebooted),
  a value with a status of "Channel Disconnected" is stored.
  Furthermore, channels can be disabled
  (see <a href="../engine/default.htm">ArchiveEngine
  configuration</a>)
  or the ArchiveEngine can be stopped.
  Some tools allow you to see these informational values when
  exporting the data with an additional "text" or "status" column.
  Others might just show "#N/A" to indicate that this value
  has no numeric meaning.
 

  <h2>Time Stamp Issues</h2>
  The ChannelArchiver uses the full EPICS time stamps as they
  are served by the ChannelAccess server (usually IOCs).
  The EPICS time stamps provide accuracy up to the nanosecond level
  and the ChannelArchiver saves those stamps without loss. The clocks
  of multiple I/O controllers can be synchronized to a high degree, so
  time stamps remain comparable even if the channels originate from
  different machines.
  <br>
  A problem arises when you compare different channels. The time
  stamps might differ slightly because a single CPU cannot scan
  several channels exactly at once. In addition, scan tasks on
  different machines are not synchronized, you might also want to
  compare channels that were scanned at different rates or were
  archived on change ('monitored'). <br>
  The net result is that for a given exact point in time the archiver
  will seldom find more than one value. When exporting in a
  spreadsheet format, '#N/A' is used to indicate this:
  <center><table BORDER="1">
    <tr>
      <th>Time</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.700986000</td>
      <td>0.0718241</td>
      <td>#N/A</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.701046000</td>
      <td>#N/A</td>
      <td>-0.0860064</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:37.400964000</td>
      <td>0.0543581</td>
      <td>#N/A</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:37.510961000</td>
      <td>#N/A</td>
      <td>-0.111776</td>
    </tr>
    <tr>
      <td>...</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
  </table>
  </center>
  In the example, the time stamps of channels A and B are obviously
  &quot;close&quot;, but they are still different and cannot
  simply be put on a single line in a spreadsheet format.<br>
  You can still plot this data, even with interpolated lines, but
  calculations like &quot;A-B&quot; will always yield '#N/A' for the
  example above since either A or B is undefined.

  <h2>Filling, Staircase Interpolation</h2>
  When the &quot;Fill&quot; option is enabled, the previous value of a
  channel will be repeated, filling what used to end up as
  &quot;#N/A&quot; in the original data:

  <center>
  <table BORDER="1">
    <tr>
      <th>Time</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.700986000</td>
      <td>0.0718241</td>
      <td>#N/A</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.701046000</td>
      <td>0.0718241</td>
      <td>-0.0860064</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:37.400964000</td>
      <td>0.0543581</td>
      <td>-0.0860064</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:37.510961000</td>
      <td>0.0543581</td>
      <td>-0.111776</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:39.410965000</td>
      <td>0.139948</td>
      <td>-0.111776</td>
    </tr>
    <tr>
      <td>...</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
  </table>
  </center>
  The remaining '#N/A' entries are caused by special conditions,
  e.g. a disconnected channel. An initial undefined value appears
  because the filling mechanism starts only after the channel has a
  valid value.<br>
  To remind you that these time stamps are not the exact ones from the
  archive, a comment is added to the header of the exported data. (A
  similar remark is added for the following, time-stamp-changing
  operations)

  <h2>Linear Interpolation</h2>
  With linear interpolation, time stamps will be chosen with a fixed
  period as specified in the &quot;Interpolate&quot; field. The values
  are then interpolated from the raw values:

  <center>
  <table BORDER="1">
    <tr>
      <th>Time</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.700986000</td>
      <td>0.0718241</td>
      <td>#N/A</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:28.701046000</td>
      <td>#N/A</td>
      <td>-0.0860064</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:30.000000000</td>
      <td>0.0692162</td>
      <td>-0.089806</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:32.000000000</td>
      <td>0.065201</td>
      <td>-0.0956562</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:34.000000000</td>
      <td>0.0611858</td>
      <td>-0.101506</td>
    </tr>
    <tr>
      <td>3/22/2000 17:02:36.000000000</td>
      <td>0.0571706</td>
      <td>-0.107357</td>
    </tr>
  </table>
  </center>
  Again some undefined values remain initially and whenever special
  conditions don't allow interpolation.

  <h2>Available Tools</h2>
  <A HREF="../overview/default.htm#retrieval">
  .. are listed in the overview.</A>.

  <hr>
  <a href="../default.htm">ChannelArchiver Manual</a>

</blockquote>
</html>

