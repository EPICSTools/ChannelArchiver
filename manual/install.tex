\chapter{Setup, Installation}

\section{Compilation}
The archiver tools use the EPICS build system as for example described
in the ``EPICS: Input/Output Controller Application Developer's
Guide'' for Release 3.14.4.  This means you need the following
prerequisites:
\begin{enumerate}
\item EPICS Base R3.14.4 (or later) needs to be built and installed.\\
      Unless you are running Linux, this might require getting a
      compiler, perl and gnumake.
\item An EPICS extensions setup: config directory with the RELEASE
      file appropriately configured to point to your EPICS base installation.
\item ChannelArchiver sources, placed in the ``src'' subdirectory of
      your EPICS extensions directory tree. 
\end{enumerate}

\noindent All the above is either pretty obvious to those who know it
already or beyond this manual to explain, in which case we have to
refer you to the EPICS web site
\href{http://www.aps.anl.gov/epics}{http://www.aps.anl.gov/epics}. 

You need to read and maybe adjust Tools/ToolsConfig.h and
Tools/ArchiverConfig.h to suit your needs.  In addition, some open
source tools and libraries are required which are listed in the
following subsections. They are included in the ``ThirdParty''
subdirectory of the archiver sources.

\subsection{XML-RPC}
The archiver's network data server uses XML-RPC. The \INDEX{XML-RPC
Setup} requires the installation of at least the C/C++ support. The
Java archive data client includes the JAR files for XML-RPC access
from Java. If you want to access the archive data server from e.g.\ perl,
this would mean you have to install XML-RPC support for perl, too
(one of which is included in the ThirdParty subdirectory of the
archiver sources).

For C and C++, we use xmlrpc-c from
\href{http://xmlrpc-c.sourceforge.net}{http://xmlrpc-c.sourceforge.net}.
The Makefiles in ChannelArchiver/XMLRPCServer assume this to be
installed in the default location, that is under /usr/local.

With RedHat~6.2, xmlrpc-c compiled out of the box.
Under RedHat~9.0, it ran into a compile-time error that could be fixed
by un-commenting ``using namespace std;'' in the header file which
reported the error.
Under Mandrake~10, there were at additional errors that can be fixed
by replacing includes for ``strstream.h'' with ``strstream'' in the affected files.

\subsection{Xerces XML Library}
The \INDEX{Xerces} library is used to parse the XML configuration files of the
ArchiveEngine, IndexTool, and the network data server.
See ``Xerces C++'' under
\begin{center}
\href{http://xml.apache.org/index.html}{http://xml.apache.org/index.html}
\end{center}
or try this direct link:
\begin{center}
\href{http://xml.apache.org/xerces-c/index.html}
     {http://xml.apache.org/xerces-c/index.html}
\end{center}
to get the sources. The Makefiles assume this to be installed under /usr/local.
Example installation under RH9:
\begin{lstlisting}[keywordstyle=\sffamily]
tar vzoxf xerces-c-current.tar.gz 
cd xerces-c-src2_4_0
export XERCESCROOT=`pwd`
cd $XERCESCROOT/src/xercesc
autoconf
./runConfigure -plinux -cgcc -xg++\
               -minmem -nsocket \
               -tnative -rpthread \
                -P/usr/local
make
su
make install
\end{lstlisting}
% Building Samples
%cd $XERCESCROOT/samples
%./runConfigure -plinux -cgcc -xg++
%make
%ls ../bin
%make clean

\subsection{Expat}
As an inferior alternative to Xerces, the \INDEX{Expat} library is supported
after changing Tools/FUX.h. Expat comes with e.g.\ RedHat~9,
otherwise see
\begin{center}
\href{http://expat.sourceforge.net}{http://expat.sourceforge.net}.
\end{center}
Expat might be a little faster and easier to install, but it does not
offer validation, so it will be up to you to assert that all XML
configuration files are 100\% perfect.

\subsection{XML-Simple}
This XML library for perl is used by the ArchiveDaemon.
It is available from 
\begin{center}
\href{http://www.cpan.org}{http://www.cpan.org}.
\end{center}
\begin{lstlisting}[keywordstyle=\sffamily]
tar vzoxf XML-Simple-2.09.tar.gz
cd XML-Simple-2.09
perl Makefile.PL
su
make install
\end{lstlisting}

\section{Installation}
There are no specific installation procedures for the ArchiveEngine,
ArchiveExport, and most other Channel Archiver components. The
binaries for them end up in the standard EPICS extension directories,
which should therefore be included in the search path. If the archiver
libraries were build as shared libraries, most Unix systems will
require the extensions' lib directory be added to the
LD\_LIBRARY\_PATH. The same applies to other helper libraries like
Xerces that might be in the form of shared libraries.

The usage of the ArchiveEngine and other archiver tools might require
configuration files, the format of which is described as part of the
tools section in this manual.

The ArchiveDataServer requires integration with your web server. The
process is exemplified in the Data Server chapter starting on page
\pageref{sec:dataserver}.

\subsection{DTD Files} \label{sec:dtdfiles}
Many of the configuration files use XML, and document type
definitions are provided in the form of DTD files
(See ArchiveDataServer configuration in \ref{lst:serverconfigdtd},
 ArchiveEngine config.\ in \ref{lst:engineconfigdtd}, ArchiveDaemon in
 \ref{lst:daemonconfigdtd}, ArchiveIndexTool config.\ in
 \ref{lst:indexconfigdtd}).
You are \emph{strongly} encouraged to reference these DTD files in all
your XML files, and to use the validating Xerces XML library, so that
all your XML get valiated while the ChannelArchiver tools use them.
This means that your XML files need to include a DOCTYPE declaration
that points to the location of the respective DTD file.
In practice, there are at least three ways to accomplish this:
\begin{enumerate}
\item Whereever you create an XML file, you copy the DTD into the same
  directory. Then you can refer to the DTD like this: 
  \begin{lstlisting}[keywordstyle=\sffamily]
  <!DOCTYPE engineconfig SYSTEM "engineconfig.dtd">
  \end{lstlisting}
  \noindent Not the best idea because you need multiple copies of the
  DTD and this is hard to maintain in case the DTD gets updated.
\item You install the DTD files in a common location in the local file
  system, e.g.\ in ``/archiver/dtd''. Then you can refer to the DTD like this: 
  \begin{lstlisting}[keywordstyle=\sffamily]
  <!DOCTYPE engineconfig
  SYSTEM "/archiver/dtd/engineconfig.dtd">
  \end{lstlisting}
  \noindent This might still require copies of the DTD on multiple computers.
\item You install the DTD files in the directory tree of a web server
  that is accessible to all your computers.
  Then you can refer to the DTD via a URL like this: 
  \begin{lstlisting}[keywordstyle=\sffamily]
  <!DOCTYPE engineconfig
  SYSTEM "http://webserver/archdtd/engineconfig.dtd">
  \end{lstlisting}
\end{enumerate}
