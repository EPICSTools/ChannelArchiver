-*- outline -*-

S u p p o r t   f o r   M a t l a b

* So far...
the LibIO provides a MatlabExporter class.
It's used by e.g. the command-line ArchiveExport and WinBrowser tool.

For casi there is a ml_dump.pl perl script that generates the same
output format.

* Format
Each channel is exported as a structure with these elements:

 t - time string
 v - value
 s - status      
 d - date number
 l - length of data
 n - name

Example:
fred.t(1)={'03-22-2000 17:02:28.700986000'};
fred.v(1)=0.0718;
fred.s(228)={''};
...
fred.t(228)={'03-22-2000 17:10:10.231108000;'};
fred.v(228)=nan;
fred.s(228)={'Archive_Off'};
...
fred.d=datenum(char(fred.t));
fred.l=size(fred.v,2);
fred.n='fred';

The t field contains the full time information from the archive.
This can rarely be used in Matlab, however, so it's converted into a Matlab
date/time number (supported since at least MatLab V.4.2).

The l and n fields allow the definition of generic Matlab functions,
see the following example.

* Generic use in Matlab

This is one example of a generic function that plots the
data of a channel over time:

     function archdataplot(data)
     % archdataplot(data)
     %
     % 2D plot of data as generated by mldump.pl
     %

     plot(data.d, data.v);
     datetick('x');
     l=max(size(data.d));
     xlabel([datestr(data.d(1)) ' - ' datestr(data.d(l))]);
     title(data.n);

* Design Decisions
There are several options for exporting data to Matlab.

The most interesting part is the handling of time/date.

From what I understand, Chris Larrieu @ JLab implemented this format:
     start, end time  - string

     channel data: one array for the values,
                   another array with a normalized time number, meaning:
                   0.0  == start time
                   1.0  == end time.

This format is most compact and very quick to import,
especially when directly generating binary Matlab files.

Drawback:
It's not trivial to get the 'real' time stamp for a value.
The meaning of a time 'x.y' depends on the chosen start and end time.
Time values from different exports are not comparable without
translation, so correlation between channels is difficult.

-> The ChannelArchiver tools export the full time stamp as a string.
   Matlab date/time numbers are used for plotting.


